<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Amor - Para KIM</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Nuevos estilos para efectos especiales */
        .blackout-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10002;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity 1s ease;
        }
        
        .blackout-overlay.active {
            display: flex;
            opacity: 1;
        }
        
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10003;
            pointer-events: none;
        }
        
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .firework-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .spectacular-title {
            font-family: 'Dancing Script', cursive;
            font-size: 5rem;
            color: #ffd700;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            animation: titleGlow 2s infinite alternate;
            z-index: 10004;
            display: none;
        }
        
        @keyframes titleGlow {
            0% {
                text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 40px rgba(255, 215, 0, 0.7);
                transform: scale(1.05);
            }
        }
        
        .love-messages-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10005;
            pointer-events: none;
        }
        
        .love-message-big {
            position: absolute;
            font-size: 4rem;
            font-weight: bold;
            color: #ff6b8b;
            font-family: 'Dancing Script', cursive;
            text-shadow: 0 0 20px rgba(255, 107, 139, 0.8);
            opacity: 0;
            pointer-events: none;
            white-space: nowrap;
        }
        
        .music-player-mini {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 10006;
            border: 2px solid rgba(255, 215, 0, 0.3);
            display: none;
        }
        
        .music-player-mini.active {
            display: flex;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translate(-50%, 100px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }
        
        .music-info {
            color: white;
            text-align: center;
        }
        
        .song-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .song-artist {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .music-controls {
            display: flex;
            gap: 10px;
        }
        
        .music-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid rgba(255, 215, 0, 0.5);
            background: transparent;
            color: #ffd700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .music-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }
        
        .countdown {
            font-size: 8rem;
            font-weight: bold;
            color: #ffd700;
            font-family: 'Dancing Script', cursive;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            margin-bottom: 20px;
            z-index: 10007;
        }
        
        .return-btn {
            position: fixed;
            bottom: 40px;
            right: 40px;
            padding: 15px 30px;
            background: linear-gradient(135deg, #ff6b8b, #ff2e63);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10008;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            display: none;
        }
        
        .return-btn.show {
            opacity: 1;
            transform: translateY(0);
            display: flex;
        }
        
        .return-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 107, 139, 0.5);
        }
        
        /* Ajustar el modal para que est√© por encima de todo */
        .modal {
            z-index: 10009;
        }
        
        /* Estilo para las estrellas */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            animation: twinkle 2s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.2; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Navegaci√≥n flotante -->
    <nav class="floating-nav">
        <div class="nav-buttons">
            <button class="nav-btn" id="home-btn" title="Inicio">
                <i class="fas fa-home"></i>
            </button>
            <a href="timeline.html" class="nav-btn" id="timeline-btn" title="Nuestra Historia">
                <i class="fas fa-heartbeat"></i>
            </a>
            <a href="gallery.html" class="nav-btn" id="gallery-btn" title="Galer√≠a">
                <i class="fas fa-images"></i>
            </a>
            <a href="game.html" class="nav-btn" id="game-btn" title="Juego">
                <i class="fas fa-gamepad"></i>
            </a>
            <a href="music.html" class="nav-btn" id="music-btn" title="M√∫sica">
                <i class="fas fa-music"></i>
            </a>
            <button class="nav-btn" id="theme-btn" title="Cambiar tema">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </nav>

    <!-- Contador de d√≠as especial -->
    <div class="special-counter">
        <div class="counter-item">
            <span class="counter-number" id="days-together">117</span>
            <span class="counter-label">D√≠as Juntos</span>
        </div>
        <div class="counter-item">
            <span class="counter-number">117</span>
            <span class="counter-label">Razones de Amor</span>
        </div>
        <div class="counter-item">
            <span class="counter-number" id="love-level">100%</span>
            <span class="counter-label">Nivel de Amor</span>
        </div>
    </div>

    <!-- Efectos de part√≠culas -->
    <div id="particles-js"></div>

    <div class="background-animation"></div>
    
    <div class="container">
        <header class="header">
            <div class="heart-icon">‚ù§Ô∏è</div>
            <h1 class="title">Para Mi Amor, KIM</h1>
            <p class="subtitle">Cada d√≠a es una nueva raz√≥n para amarte m√°s</p>
            <div class="days-counter">D√≠a <span id="current-day">1</span> de 117</div>
            
            <!-- Buscador de mensajes -->
            <div class="search-container">
                <input type="text" id="search-messages" placeholder="Buscar mensajes especiales...">
                <i class="fas fa-search"></i>
            </div>
        </header>

        <main class="main-content">
            <!-- Filtros por categor√≠as -->
            <div class="filters">
                <button class="filter-btn active" data-filter="all">Todos</button>
                <button class="filter-btn" data-filter="romantic">Rom√°nticos</button>
                <button class="filter-btn" data-filter="future">Futuro</button>
                <button class="filter-btn" data-filter="funny">Divertidos</button>
                <button class="filter-btn" data-filter="deep">Profundos</button>
            </div>

            <div class="letters-grid" id="letters-container">
                <!-- Las cartitas se generar√°n con JavaScript -->
            </div>

            <!-- Barra de progreso -->
            <div class="progress-container">
                <div class="progress-bar" id="love-progress"></div>
                <div class="progress-text">
                    <span>Progreso del Amor</span>
                    <span id="progress-percent">0%</span>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <p>Hecho con <span class="heart-pulse">‚ù§Ô∏è</span> especialmente para ti, mi amor</p>
                <div class="footer-buttons">
                    <button class="secret-btn" id="secret-surprise">
                        <i class="fas fa-gift"></i> Sorpresa Secreta
                    </button>
                    <button class="print-btn" id="print-all">
                        <i class="fas fa-print"></i> Guardar Todos
                    </button>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal mejorado -->
    <div class="modal" id="message-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-day">D√≠a 1</h2>
                <div class="heart-decoration">üíñ</div>
                <div class="modal-actions">
                    <button class="action-btn" id="copy-message">
                        <i class="far fa-copy"></i>
                    </button>
                    <button class="action-btn" id="share-message">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button class="action-btn" id="save-favorite">
                        <i class="far fa-heart"></i>
                    </button>
                    <button class="action-btn close-modal" id="close-modal-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="message-icon" id="modal-icon">üòä</div>
                <p id="modal-message"></p>
            </div>
            <div class="modal-footer">
                <button id="love-btn" class="love-button">
                    <i class="fas fa-heart"></i> TE AMO INFINITAMENTE ‚ù§Ô∏è
                </button>
                <button id="next-btn" class="next-button">
                    Siguiente <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Notificaciones flotantes -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <i class="fas fa-heart"></i>
            <span id="notification-text"></span>
        </div>
    </div>

    <!-- √Årea de efectos especiales -->
    <canvas id="fireworks-canvas"></canvas>
    <canvas id="hearts-canvas"></canvas>

    <!-- Mensaje de amor flotante -->
    <div id="floating-love" class="floating-love">TE AMO</div>

    <!-- Nuevos elementos para el espect√°culo -->
    <div class="blackout-overlay" id="blackout-overlay">
        <div class="countdown" id="countdown">3</div>
        <h1 class="spectacular-title" id="spectacular-title">Para Mi Amor, KIM</h1>
    </div>
    
    <div class="fireworks-container" id="fireworks-container"></div>
    <div class="love-messages-container" id="love-messages-container"></div>
    
    <div class="music-player-mini" id="music-player-mini">
        <div class="music-info">
            <div class="song-title">Yellow</div>
            <div class="song-artist">Coldplay - Para ti, mi amor</div>
        </div>
        <div class="music-controls">
            <button class="music-btn" id="play-music-btn">
                <i class="fas fa-play"></i>
            </button>
            <button class="music-btn" id="pause-music-btn">
                <i class="fas fa-pause"></i>
            </button>
            <button class="music-btn" id="stop-music-btn">
                <i class="fas fa-stop"></i>
            </button>
        </div>
    </div>
    
    <button class="return-btn" id="return-btn">
        <i class="fas fa-arrow-left"></i> Volver
    </button>

    <!-- Audio para efectos -->
    <audio id="heart-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-heartbeat-100.mp3" type="audio/mpeg">
    </audio>
    <audio id="sparkle-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-300.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Audio para la canci√≥n Yellow -->
    <audio id="yellow-song" preload="auto">
        <source src="assets/music/yellow.mp3" type="audio/mpeg">
        <!-- Si el archivo no existe, usar una versi√≥n online como respaldo -->
        <source src="https://assets.mixkit.co/music/preview/mixkit-happy-day-583.mp3" type="audio/mpeg">
    </audio>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // Datos mejorados con categor√≠as
        const messages = [
    {
        day: 1,
        message: "Tu sonrisa ilumina mis d√≠as m√°s grises. Desde que est√°s en mi vida, todo tiene m√°s color.",
        icon: "üòä",
        category: "romantic"
    },
    {
        day: 2,
        message: "Contigo he descubierto un amor que no conoc√≠a. Un amor que sana, que comprende, que perdona.",
        icon: "‚ù§Ô∏è",
        category: "romantic"
    },
    {
        day: 3,
        message: "Eres la raz√≥n por la que creo en el destino. No fue casualidad encontrarte, fue el universo conspirando a nuestro favor.",
        icon: "‚ú®",
        category: "romantic"
    },
    {
        day: 4,
        message: "Mi ni√±o interior revive cuando estoy contigo. Esas ganas de jugar, de re√≠r sin motivo, de so√±ar despierto.",
        icon: "üë¶",
        category: "funny"
    },
    {
        day: 5,
        message: "Me haces sentir que puedo conquistar el mundo. Tu fe en m√≠ es mi mayor motivaci√≥n.",
        icon: "üåé",
        category: "deep"
    },
    {
        day: 6,
        message: "Tu mirada despierta mariposas en mi est√≥mago. Esos nervios que solo t√∫ provocas en m√≠.",
        icon: "ü¶ã",
        category: "romantic"
    },
    {
        day: 7,
        message: "Cada momento a tu lado es un tesoro. Guardo cada risa, cada abrazo, cada mirada en el cofre de mis mejores recuerdos.",
        icon: "üíé",
        category: "romantic"
    },
    {
        day: 8,
        message: "Eres el sue√±o que nunca quise despertar. Contigo la realidad supera cualquier fantas√≠a.",
        icon: "üí≠",
        category: "romantic"
    },
    {
        day: 9,
        message: "Tu amor sana las heridas de mi pasado. Donde hab√≠a dolor, ahora hay esperanza gracias a ti.",
        icon: "ü©π",
        category: "deep"
    },
    {
        day: 10,
        message: "Contigo quiero construir un futuro lleno de risas. Un hogar donde el amor sea el cimiento m√°s fuerte.",
        icon: "üè°",
        category: "future"
    },
    {
        day: 11,
        message: "Eres mi refugio en los d√≠as dif√≠ciles. En tus brazos encuentro la paz que mi alma necesita.",
        icon: "üõ°Ô∏è",
        category: "deep"
    },
    {
        day: 12,
        message: "Tu voz es la melod√≠a que calma mi alma. Podr√≠a escucharte hablar por horas sin cansarme.",
        icon: "üéµ",
        category: "romantic"
    },
    {
        day: 13,
        message: "Amo la persona que soy cuando estoy contigo. Me inspiras a ser mejor cada d√≠a.",
        icon: "üåü",
        category: "deep"
    },
    {
        day: 14,
        message: "Eres la respuesta a todas mis preguntas. En tu amor encontr√© el sentido que tanto buscaba.",
        icon: "‚ùì",
        category: "deep"
    },
    {
        day: 15,
        message: "Tu amor me da fuerzas para ser mejor cada d√≠a. Quiero merecerte, quiero ser tu orgullo.",
        icon: "üí™",
        category: "deep"
    },
    {
        day: 16,
        message: "Contigo hasta lo simple se vuelve m√°gico. Un paseo, una comida, una tarde en casa... todo es especial contigo.",
        icon: "üîÆ",
        category: "romantic"
    },
    {
        day: 17,
        message: "Eres mi confidente y mi mejor amiga. Puedo contarte mis mayores sue√±os y mis peores miedos.",
        icon: "ü§ù",
        category: "deep"
    },
    {
        day: 18,
        message: "Tu risa es mi sonido favorito. Es contagiosa, aut√©ntica, y llena mi coraz√≥n de alegr√≠a.",
        icon: "üòÇ",
        category: "funny"
    },
    {
        day: 19,
        message: "Amo c√≥mo me miras, como si fuera √∫nico. Esa mirada que me hace sentir el hombre m√°s afortunado del mundo.",
        icon: "üëÄ",
        category: "romantic"
    },
    {
        day: 20,
        message: "Eres el regalo que la vida me dio despu√©s de tanto esperar. Vali√≥ la pena la espera.",
        icon: "üéÅ",
        category: "romantic"
    },
    {
        day: 21,
        message: "Contigo quiero envejecer riendo. Ver c√≥mo se nos llena el rostro de arrugas, pero el coraz√≥n de amor.",
        icon: "üëµüë¥",
        category: "future"
    },
    {
        day: 22,
        message: "Tu amor me hace sentir completo. Esas partes de m√≠ que faltaban, ahora est√°n aqu√≠ contigo.",
        icon: "üß©",
        category: "deep"
    },
    {
        day: 23,
        message: "Eres mi paz en medio del caos. Cuando el mundo gira demasiado r√°pido, t√∫ eres mi centro.",
        icon: "üïäÔ∏è",
        category: "deep"
    },
    {
        day: 24,
        message: "Amo cada detalle, cada gesto, cada mirada tuya. Me enamoro m√°s de ti cada d√≠a.",
        icon: "üìù",
        category: "romantic"
    },
    {
        day: 25,
        message: "Contigo el tiempo vuela y se detiene a la vez. Los minutos pasan r√°pido, pero los momentos quedan para siempre.",
        icon: "‚è≥",
        category: "romantic"
    },
    {
        day: 26,
        message: "Eres la due√±a de mis pensamientos. Me despierto pensando en ti y me duermo so√±ando contigo.",
        icon: "ü§î",
        category: "romantic"
    },
    {
        day: 27,
        message: "Tu amor es el combustible de mis sue√±os. Contigo a mi lado, siento que puedo lograr cualquier cosa.",
        icon: "üöÄ",
        category: "deep"
    },
    {
        day: 28,
        message: "Eres mi inspiraci√≥n para ser mejor. Quiero ser la versi√≥n m√°s grandiosa de m√≠ mismo para ti.",
        icon: "üí°",
        category: "deep"
    },
    {
        day: 29,
        message: "Amo c√≥mo encajas perfectamente en mi vida. Como si siempre hubieras estado destinada a estar aqu√≠.",
        icon: "üîë",
        category: "romantic"
    },
    {
        day: 30,
        message: "Contigo quiero compartir todos mis d√≠as. Los buenos, los malos, los simples, los extraordinarios.",
        icon: "üìÖ",
        category: "future"
    },
    {
        day: 31,
        message: "Eres la luz que gu√≠a mi camino. En la oscuridad, t√∫ eres mi faro, mi esperanza.",
        icon: "üí°",
        category: "deep"
    },
    {
        day: 32,
        message: "Tu amor es mi mayor fortuna. No cambiar√≠a lo que siento por ti por todo el oro del mundo.",
        icon: "üí∞",
        category: "romantic"
    },
    {
        day: 33,
        message: "Eres mi raz√≥n para sonre√≠r sin motivo. Esa felicidad interna que brota cuando pienso en ti.",
        icon: "üòÑ",
        category: "romantic"
    },
    {
        day: 34,
        message: "Contigo todo tiene m√°s sentido. Los planes, los esfuerzos, las luchas... todo vale la pena por nuestro amor.",
        icon: "üéØ",
        category: "deep"
    },
    {
        day: 35,
        message: "Amo c√≥mo me haces sentir amado. Esa seguridad de saber que soy importante para ti.",
        icon: "üíñ",
        category: "romantic"
    },
    {
        day: 36,
        message: "Eres mi eterno y √∫nico amor. No imagino mi vida sin ti, no quiero mi vida sin ti. Eres mi todo.",
        icon: "‚àû",
        category: "romantic"
    },
    // Mensajes del 37 al 63 (manteniendo los que ya ten√≠as)
    {
        day: 37,
        message: "Tu amor transforma lo ordinario en extraordinario. Conviertes cada instante en un recuerdo inolvidable.",
        icon: "‚ú®",
        category: "romantic"
    },
    {
        day: 38,
        message: "Contigo aprend√≠ que el amor verdadero existe y que es m√°s hermoso de lo que imaginaba.",
        icon: "üíï",
        category: "deep"
    },
    {
        day: 39,
        message: "Eres el cap√≠tulo m√°s bello de mi historia. Cada d√≠a contigo es una p√°gina que atesoro con el alma.",
        icon: "üìñ",
        category: "deep"
    },
    {
        day: 40,
        message: "Me robaste el coraz√≥n y ahora eres mi ladrona favorita. ¬°Pero no me lo devuelvas nunca!",
        icon: "üòè",
        category: "funny"
    },
    {
        day: 41,
        message: "Tu amor es mi refugio seguro. En tus brazos el mundo desaparece y solo existimos t√∫ y yo.",
        icon: "üõ°Ô∏è",
        category: "deep"
    },
    {
        day: 42,
        message: "Contigo descubro nuevas razones para vivir cada d√≠a. Eres mi aventura favorita.",
        icon: "üß≠",
        category: "romantic"
    },
    {
        day: 43,
        message: "Eres la melod√≠a perfecta que armoniza mi vida. Sin ti, todo ser√≠a silencio.",
        icon: "üé∂",
        category: "romantic"
    },
    {
        day: 44,
        message: "Amo c√≥mo construimos recuerdos juntos. Cada experiencia compartida es un tesoro eterno.",
        icon: "üì∏",
        category: "future"
    },
    {
        day: 45,
        message: "Tu ternura es el b√°lsamo que cura cualquier herida. En tus gestos encuentro el amor m√°s puro.",
        icon: "ü´Ç",
        category: "deep"
    },
    {
        day: 46,
        message: "Contigo el amor crece cada d√≠a como un √°rbol fuerte que echa ra√≠ces profundas.",
        icon: "üå≥",
        category: "future"
    },
    {
        day: 47,
        message: "Eres mi confidente de sue√±os locos. Contigo puedo ser completamente yo sin miedo al juicio.",
        icon: "üå†",
        category: "deep"
    },
    {
        day: 48,
        message: "Tu amor es el mejor regalo que he recibido. M√°s valioso que cualquier tesoro material.",
        icon: "üéÅ",
        category: "romantic"
    },
    {
        day: 49,
        message: "Amo c√≥mo celebramos juntos cada peque√±a victoria. Contigo hasta lo peque√±o se siente enorme.",
        icon: "üèÜ",
        category: "funny"
    },
    {
        day: 50,
        message: "Eres mi compa√±era de todas las aventuras. Desde las m√°s simples hasta las m√°s extraordinarias.",
        icon: "üó∫Ô∏è",
        category: "future"
    },
    {
        day: 51,
        message: "Tu amor ilumina mis d√≠as m√°s oscuros como una estrella que brilla en la noche.",
        icon: "‚≠ê",
        category: "deep"
    },
    {
        day: 52,
        message: "Contigo aprend√≠ el verdadero significado de la complicidad. Esa conexi√≥n que solo nosotros entendemos.",
        icon: "üîí",
        category: "deep"
    },
    {
        day: 53,
        message: "Eres la calma despu√©s de cada tormenta. En tu presencia encuentro paz y serenidad.",
        icon: "‚õÖ",
        category: "deep"
    },
    {
        day: 54,
        message: "Amo c√≥mo crecemos juntos, entrelazando nuestras vidas y fortaleci√©ndonos mutuamente.",
        icon: "üå±",
        category: "future"
    },
    {
        day: 55,
        message: "Tu amor es mi mayor inspiraci√≥n para crear, so√±ar y creer en lo imposible.",
        icon: "üé®",
        category: "deep"
    },
    {
        day: 56,
        message: "Eres el hogar al que siempre quiero volver. Donde sea que estemos, contigo estoy en casa.",
        icon: "üè†",
        category: "romantic"
    },
    {
        day: 57,
        message: "Contigo el presente es un regalo y el futuro una promesa llena de esperanza.",
        icon: "üéÅ",
        category: "future"
    },
    {
        day: 58,
        message: "Tu amor transform√≥ mi vida completamente. Donde hab√≠a vac√≠o, ahora hay plenitud absoluta.",
        icon: "ü¶ã",
        category: "deep"
    },
    {
        day: 59,
        message: "Eres mi raz√≥n para creer en los milagros. Encontrarte fue el m√°s hermoso de todos.",
        icon: "üôè",
        category: "romantic"
    },
    {
        day: 60,
        message: "Amo c√≥mo nuestro amor supera cualquier obst√°culo. Juntos somos m√°s fuertes que cualquier desaf√≠o.",
        icon: "üöß",
        category: "deep"
    },
    {
        day: 61,
        message: "Eres mi amor infinito, mi siempre y para siempre. Hoy y todos los d√≠as de mi vida.",
        icon: "üí´",
        category: "romantic"
    },
    {
        day: 62,
        message: "Tu risa es contagiosa y tu alegr√≠a es mi combustible. Me haces sentir vivo de una manera √∫nica.",
        icon: "üòÇ",
        category: "funny"
    },
    {
        day: 63,
        message: "Eres el sue√±o que eleg√≠ vivir cada d√≠a. Mi amor por ti crece con cada amanecer.",
        icon: "üåÖ",
        category: "romantic"
    },
    // NUEVOS MENSAJES (D√≠a 64 al 117)
    {
        day: 64,
        message: "Cada latido de mi coraz√≥n lleva tu nombre. Es como si mi cuerpo supiera que te pertenece por completo.",
        icon: "üíì",
        category: "romantic"
    },
    {
        day: 65,
        message: "Contigo aprendo el significado del amor paciente. Ese que espera, que comprende, que nunca se cansa.",
        icon: "‚è≥",
        category: "deep"
    },
    {
        day: 66,
        message: "Eres la nota perfecta en la melod√≠a de mi vida. Sin ti, mi canci√≥n no tendr√≠a sentido.",
        icon: "üéµ",
        category: "romantic"
    },
    {
        day: 67,
        message: "Amo c√≥mo incluso en silencio podemos comunicarnos. Nuestras almas conversan sin necesidad de palabras.",
        icon: "ü§´",
        category: "deep"
    },
    {
        day: 68,
        message: "Eres mi raz√≥n para levantarme con una sonrisa. Saber que puedo verte, hablarte o pensar en ti me llena de alegr√≠a.",
        icon: "‚òÄÔ∏è",
        category: "romantic"
    },
    {
        day: 69,
        message: "Contigo quiero construir castillos en el aire y luego hacerlos realidad, ladrillo por ladrillo.",
        icon: "üè∞",
        category: "future"
    },
    {
        day: 70,
        message: "Tu amor es el faro que me gu√≠a en la tormenta. No importa lo oscuro que sea el camino, t√∫ me muestras la direcci√≥n.",
        icon: "üö¢",
        category: "deep"
    },
    {
        day: 71,
        message: "Eres el espejo que muestra la mejor versi√≥n de m√≠ mismo. Contigo me veo capaz de cosas extraordinarias.",
        icon: "ü™û",
        category: "deep"
    },
    {
        day: 72,
        message: "Amo c√≥mo nuestro amor tiene su propio lenguaje. Esas miradas, esos gestos peque√±os que solo nosotros entendemos.",
        icon: "üó£Ô∏è",
        category: "romantic"
    },
    {
        day: 73,
        message: "Eres mi puerto seguro en este oc√©ano de vida. No importa d√≥nde navegue, s√© que en ti tengo un lugar al que volver.",
        icon: "‚öì",
        category: "deep"
    },
    {
        day: 74,
        message: "Contigo hasta las tareas m√°s mundanas se vuelven divertidas. Lavar platos contigo es mejor que ir a una fiesta sin ti.",
        icon: "üçΩÔ∏è",
        category: "funny"
    },
    {
        day: 75,
        message: "Tu amor es el pegamento que une mis d√≠as. Hace que todo cobre sentido y prop√≥sito.",
        icon: "üß¥",
        category: "deep"
    },
    {
        day: 76,
        message: "Eres la poes√≠a que mi coraz√≥n siempre quiso escribir. Cada verso, cada estrofa habla de ti.",
        icon: "üìú",
        category: "romantic"
    },
    {
        day: 77,
        message: "Contigo quiero ver todos los amaneceres y atardeceres del mundo. Cada uno ser√° especial porque lo compartiremos juntos.",
        icon: "üåá",
        category: "future"
    },
    {
        day: 78,
        message: "Tu amor es mi vitamina diaria. Me da energ√≠a, me fortalece y me mantiene saludable de esp√≠ritu.",
        icon: "üíä",
        category: "funny"
    },
    {
        day: 79,
        message: "Eres la melod√≠a que no puedo sacar de mi cabeza. Y no quiero que se vaya nunca.",
        icon: "üé∂",
        category: "romantic"
    },
    {
        day: 80,
        message: "Contigo el amor no es un sentimiento, es una decisi√≥n. Y elijo amarte cada d√≠a, cada hora, cada minuto.",
        icon: "‚úÖ",
        category: "deep"
    },
    {
        day: 81,
        message: "Eres mi oasis en medio del desierto. Cuando todo parece √°rido y dif√≠cil, t√∫ eres mi fuente de vida.",
        icon: "üèúÔ∏è",
        category: "deep"
    },
    {
        day: 82,
        message: "Amo c√≥mo creamos nuestra propia burbuja de felicidad. Dentro de ella, el mundo exterior desaparece.",
        icon: "ü´ß",
        category: "romantic"
    },
    {
        day: 83,
        message: "Eres el regalo que sigue dando. Cada d√≠a descubro algo nuevo para amar de ti.",
        icon: "üéÅ",
        category: "romantic"
    },
    {
        day: 84,
        message: "Contigo quiero llenar √°lbumes de fotos con nuestros recuerdos. Cada foto ser√° una historia de amor contada en im√°genes.",
        icon: "üì∑",
        category: "future"
    },
    {
        day: 85,
        message: "Tu amor es la br√∫jula que me orienta. Siempre apunta hacia ti, mi verdadero norte.",
        icon: "üß≠",
        category: "deep"
    },
    {
        day: 86,
        message: "Eres la pieza que completa mi rompecabezas. No sab√≠a lo que me faltaba hasta que llegaste.",
        icon: "üß©",
        category: "romantic"
    },
    {
        day: 87,
        message: "Contigo hasta los d√≠as de lluvia son soleados. Porque tu presencia ilumina todo a mi alrededor.",
        icon: "üåßÔ∏è",
        category: "romantic"
    },
    {
        day: 88,
        message: "Tu amor es el abrazo m√°s c√°lido en el d√≠a m√°s fr√≠o. Me envuelve y me protege del mundo.",
        icon: "ü´Ç",
        category: "deep"
    },
    {
        day: 89,
        message: "Eres mi c√≥mplice en esta aventura llamada vida. No hay mejor compa√±era de viaje que t√∫.",
        icon: "üß≥",
        category: "romantic"
    },
    {
        day: 90,
        message: "Contigo quiero aprender todos los idiomas del amor. Y hablarte en cada uno de ellos.",
        icon: "üó£Ô∏è",
        category: "future"
    },
    {
        day: 91,
        message: "Tu amor es la chispa que enciende mi creatividad. Contigo a mi lado, las ideas fluyen sin cesar.",
        icon: "üí°",
        category: "deep"
    },
    {
        day: 92,
        message: "Eres la constelaci√≥n m√°s brillante en mi cielo personal. Siempre puedo encontrarte cuando me pierdo.",
        icon: "‚≠ê",
        category: "romantic"
    },
    {
        day: 93,
        message: "Contigo hasta las matem√°ticas son rom√°nticas: t√∫ + yo = nosotros para siempre.",
        icon: "‚ûï",
        category: "funny"
    },
    {
        day: 94,
        message: "Tu amor es el cimiento sobre el que quiero construir mi vida. Fuerte, seguro y eterno.",
        icon: "üèóÔ∏è",
        category: "future"
    },
    {
        day: 95,
        message: "Eres el suspiro de alivio despu√©s de un d√≠a largo. En tus brazos encuentro el descanso perfecto.",
        icon: "üòå",
        category: "romantic"
    },
    {
        day: 96,
        message: "Contigo quiero escribir un libro de mil p√°ginas sobre nuestro amor. Y que nunca tenga final.",
        icon: "üìö",
        category: "future"
    },
    {
        day: 97,
        message: "Tu amor es la melod√≠a que baila mi coraz√≥n. Un ritmo constante que me recuerda que est√°s aqu√≠.",
        icon: "üíÉ",
        category: "romantic"
    },
    {
        day: 98,
        message: "Eres el eslab√≥n que une todos mis sue√±os. Conectas todo lo que aspiro ser y lograr.",
        icon: "‚õìÔ∏è",
        category: "deep"
    },
    {
        day: 99,
        message: "Contigo hasta el caf√© sabe mejor por las ma√±anas. Porque lo tomo sabiendo que el d√≠a te incluye a ti.",
        icon: "‚òï",
        category: "romantic"
    },
    {
        day: 100,
        message: "Cien d√≠as dici√©ndote cu√°nto te amo y a√∫n me quedan mil cosas por decir. Eres mi amor sin fin.",
        icon: "üíØ",
        category: "romantic"
    },
    {
        day: 101,
        message: "Eres mi segunda mitad en este baile de la vida. Juntos creamos la coreograf√≠a perfecta.",
        icon: "üï∫",
        category: "romantic"
    },
    {
        day: 102,
        message: "Contigo el amor no es ciego, todo lo contrario: me hace ver con m√°s claridad que nunca.",
        icon: "üëÅÔ∏è",
        category: "deep"
    },
    {
        day: 103,
        message: "Tu amor es el eco que resuena en mi alma. Un sonido dulce que nunca se desvanece.",
        icon: "üì¢",
        category: "romantic"
    },
    {
        day: 104,
        message: "Eres el jard√≠n donde florecen mis mejores sentimientos. En ti cultivo amor, respeto y admiraci√≥n.",
        icon: "üå∑",
        category: "deep"
    },
    {
        day: 105,
        message: "Contigo quiero coleccionar momentos como quien colecciona estrellas. Cada uno brilla con luz propia.",
        icon: "üåü",
        category: "future"
    },
    {
        day: 106,
        message: "Tu amor es la sombra que me sigue en los d√≠as soleados. Siempre presente, siempre protector.",
        icon: "üå≥",
        category: "deep"
    },
    {
        day: 107,
        message: "Eres el mapa que me gu√≠a hacia la felicidad. Cada camino contigo conduce a la alegr√≠a.",
        icon: "üó∫Ô∏è",
        category: "romantic"
    },
    {
        day: 108,
        message: "Contigo hasta las equivocaciones son oportunidades para crecer juntos. Aprendemos incluso de los tropiezos.",
        icon: "üìà",
        category: "deep"
    },
    {
        day: 109,
        message: "Tu amor es la canci√≥n que mi coraz√≥n canta en silencio. Una melod√≠a eterna dedicada solo a ti.",
        icon: "üé§",
        category: "romantic"
    },
    {
        day: 110,
        message: "Eres mi refugio contra la tormenta y mi compa√±era bajo el sol. Est√©s donde est√©s, siempre eres mi lugar.",
        icon: "‚õ±Ô∏è",
        category: "deep"
    },
    {
        day: 111,
        message: "Contigo cada d√≠a es una p√°gina nueva en nuestra historia. Y estoy ansioso por escribir las siguientes.",
        icon: "üìñ",
        category: "future"
    },
    {
        day: 112,
        message: "Tu amor es el hilo que teje el tapiz de mi vida. Sin ti, el dise√±o no estar√≠a completo.",
        icon: "üßµ",
        category: "deep"
    },
    {
        day: 113,
        message: "Eres el milagro cotidiano que agradezco cada ma√±ana. Despertar sabiendo que existes es mi mayor bendici√≥n.",
        icon: "üôè",
        category: "romantic"
    },
    {
        day: 114,
        message: "Contigo quiero construir una biblioteca de recuerdos. Estantes llenos de momentos que atesoraremos por siempre.",
        icon: "üìö",
        category: "future"
    },
    {
        day: 115,
        message: "Tu amor es el ingrediente secreto que sazona mi vida. Sin ti, todo tendr√≠a menos sabor.",
        icon: "üßÇ",
        category: "funny"
    },
    {
        day: 116,
        message: "Eres la nota al margen de mi libro favorito. Esos peque√±os detalles que hacen toda la diferencia.",
        icon: "üìù",
        category: "romantic"
    },
    {
        day: 117,
        message: "Contigo el amor no es un destino, es el viaje. Y no hay mejor compa√±era de camino que t√∫, hoy y siempre.",
        icon: "üö∂‚Äç‚ôÇÔ∏è",
        category: "deep"
    }
];

        // Estado de la aplicaci√≥n
        let state = {
            currentDay: 1,
            favorites: JSON.parse(localStorage.getItem('favorites')) || [],
            viewedMessages: JSON.parse(localStorage.getItem('viewedMessages')) || [],
            theme: localStorage.getItem('theme') || 'light',
            loveLevel: parseInt(localStorage.getItem('loveLevel')) || 100,
            isSpectacleActive: false
        };

        // Elementos DOM
        const elements = {
            lettersContainer: document.getElementById('letters-container'),
            modal: document.getElementById('message-modal'),
            modalOverlay: document.querySelector('.modal-overlay'),
            modalDay: document.getElementById('modal-day'),
            modalMessage: document.getElementById('modal-message'),
            modalIcon: document.getElementById('modal-icon'),
            closeModalBtn: document.getElementById('close-modal-btn'),
            loveButton: document.getElementById('love-btn'),
            currentDayElement: document.getElementById('current-day'),
            fireworksCanvas: document.getElementById('fireworks-canvas'),
            heartsCanvas: document.getElementById('hearts-canvas'),
            floatingLove: document.getElementById('floating-love'),
            searchInput: document.getElementById('search-messages'),
            filterButtons: document.querySelectorAll('.filter-btn'),
            progressBar: document.getElementById('love-progress'),
            progressPercent: document.getElementById('progress-percent'),
            daysTogether: document.getElementById('days-together'),
            loveLevel: document.getElementById('love-level'),
            secretSurprise: document.getElementById('secret-surprise'),
            printAll: document.getElementById('print-all'),
            themeBtn: document.getElementById('theme-btn'),
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notification-text'),
            heartSound: document.getElementById('heart-sound'),
            sparkleSound: document.getElementById('sparkle-sound'),
            copyBtn: document.getElementById('copy-message'),
            shareBtn: document.getElementById('share-message'),
            saveFavoriteBtn: document.getElementById('save-favorite'),
            nextBtn: document.getElementById('next-btn'),
            // Nuevos elementos
            blackoutOverlay: document.getElementById('blackout-overlay'),
            fireworksContainer: document.getElementById('fireworks-container'),
            loveMessagesContainer: document.getElementById('love-messages-container'),
            musicPlayerMini: document.getElementById('music-player-mini'),
            countdown: document.getElementById('countdown'),
            spectacularTitle: document.getElementById('spectacular-title'),
            returnBtn: document.getElementById('return-btn'),
            playMusicBtn: document.getElementById('play-music-btn'),
            pauseMusicBtn: document.getElementById('pause-music-btn'),
            stopMusicBtn: document.getElementById('stop-music-btn'),
            yellowSong: document.getElementById('yellow-song')
        };

        // Inicializaci√≥n mejorada
        document.addEventListener('DOMContentLoaded', () => {
            init();
            updateCounters();
            updateProgress();
            // Pre-cargar la canci√≥n
            elements.yellowSong.load();
        });

        function init() {
            createLetters();
            setupEventListeners();
            setupFilters();
            setupSearch();
            applyTheme();
            updateProgress();
        }

        // Crear cartitas mejoradas
        function createLetters() {
            elements.lettersContainer.innerHTML = '';
            
            messages.forEach(msg => {
                const letter = document.createElement('div');
                letter.className = 'letter';
                letter.dataset.day = msg.day;
                letter.dataset.category = msg.category;
                
                const isViewed = state.viewedMessages.includes(msg.day);
                const isFavorite = state.favorites.includes(msg.day);
                
                if (isViewed) {
                    letter.classList.add('viewed');
                }
                
                if (isFavorite) {
                    letter.classList.add('favorite');
                    letter.innerHTML += '<div class="favorite-star">‚≠ê</div>';
                }
                
                letter.innerHTML += `
                    <div class="letter-number">D√≠a ${msg.day}</div>
                    <div class="letter-icon">${msg.icon}</div>
                    <div class="letter-content">${truncateText(msg.message, 60)}</div>
                    <div class="letter-footer">
                        <span class="letter-category">${msg.category}</span>
                    </div>
                `;
                
                letter.addEventListener('click', () => openModal(msg.day));
                
                elements.lettersContainer.appendChild(letter);
            });
        }

        // Configurar event listeners mejorados
        function setupEventListeners() {
            elements.closeModalBtn.addEventListener('click', closeMessageModal);
            elements.modalOverlay.addEventListener('click', closeMessageModal);
            elements.loveButton.addEventListener('click', showLoveSpectacle);
            elements.secretSurprise.addEventListener('click', showSecretSurprise);
            elements.printAll.addEventListener('click', printAllMessages);
            elements.themeBtn.addEventListener('click', toggleTheme);
            elements.copyBtn.addEventListener('click', copyMessage);
            elements.shareBtn.addEventListener('click', shareMessage);
            elements.saveFavoriteBtn.addEventListener('click', toggleFavorite);
            elements.nextBtn.addEventListener('click', showNextMessage);
            
            // Event listeners para controles de m√∫sica
            elements.playMusicBtn.addEventListener('click', () => {
                elements.yellowSong.play().catch(e => {
                    console.log("No se pudo reproducir la canci√≥n:", e);
                    showNotification("Reproduciendo m√∫sica alternativa");
                    elements.yellowSong.play();
                });
            });
            
            elements.pauseMusicBtn.addEventListener('click', () => {
                elements.yellowSong.pause();
            });
            
            elements.stopMusicBtn.addEventListener('click', () => {
                elements.yellowSong.pause();
                elements.yellowSong.currentTime = 0;
            });
            
            elements.returnBtn.addEventListener('click', endLoveSpectacle);
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && elements.modal.style.display === 'flex') {
                    closeMessageModal();
                }
                if (e.key === 'ArrowRight' && elements.modal.style.display === 'flex') {
                    showNextMessage();
                }
                // Tecla Espacio para pausar/reanudar m√∫sica durante el espect√°culo
                if (e.code === 'Space' && state.isSpectacleActive) {
                    e.preventDefault();
                    if (elements.yellowSong.paused) {
                        elements.yellowSong.play();
                    } else {
                        elements.yellowSong.pause();
                    }
                }
                // Tecla ESC para salir del espect√°culo
                if (e.key === 'Escape' && state.isSpectacleActive) {
                    endLoveSpectacle();
                }
            });
            
            // Cuando termine la canci√≥n
            elements.yellowSong.addEventListener('ended', () => {
                // Repetir la canci√≥n
                elements.yellowSong.currentTime = 0;
                elements.yellowSong.play();
                showNotification("üéµ Reproduciendo de nuevo üéµ");
            });
            
            // Cuando haya un error con el audio
            elements.yellowSong.addEventListener('error', (e) => {
                console.log("Error con el audio:", e);
                showNotification("Usando m√∫sica alternativa");
            });
        }

        // Configurar filtros
        function setupFilters() {
            elements.filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const filter = btn.dataset.filter;
                    filterLetters(filter);
                });
            });
        }

        // Configurar b√∫squeda
        function setupSearch() {
            elements.searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                filterBySearch(searchTerm);
            });
        }

        // Filtrar cartitas
        function filterLetters(category) {
            const letters = document.querySelectorAll('.letter');
            
            letters.forEach(letter => {
                if (category === 'all' || letter.dataset.category === category) {
                    letter.style.display = 'flex';
                } else {
                    letter.style.display = 'none';
                }
            });
        }

        // Filtrar por b√∫squeda
        function filterBySearch(term) {
            const letters = document.querySelectorAll('.letter');
            
            letters.forEach(letter => {
                const day = letter.dataset.day;
                const message = messages.find(m => m.day == day);
                
                if (message.message.toLowerCase().includes(term) || term === '') {
                    letter.style.display = 'flex';
                } else {
                    letter.style.display = 'none';
                }
            });
        }

        // Abrir modal mejorado
        function openModal(day) {
            const messageData = messages.find(msg => msg.day == day);
            if (messageData) {
                state.currentDay = day;
                
                elements.modalDay.textContent = `D√≠a ${messageData.day}`;
                elements.modalMessage.textContent = messageData.message;
                elements.modalIcon.textContent = messageData.icon;
                
                // Marcar como visto
                if (!state.viewedMessages.includes(day)) {
                    state.viewedMessages.push(day);
                    localStorage.setItem('viewedMessages', JSON.stringify(state.viewedMessages));
                    updateProgress();
                }
                
                // Actualizar bot√≥n de favorito
                updateFavoriteButton(day);
                
                // Mostrar modal
                elements.modal.style.display = 'flex';
                
                updateCurrentDay(day);
                
                // Efecto de entrada
                playSound(elements.sparkleSound);
            }
        }

        // Cerrar modal
        function closeMessageModal() {
            elements.modal.style.display = 'none';
        }

        // Actualizar bot√≥n de favorito
        function updateFavoriteButton(day) {
            const isFavorite = state.favorites.includes(day);
            elements.saveFavoriteBtn.innerHTML = isFavorite ? 
                '<i class="fas fa-heart"></i>' : 
                '<i class="far fa-heart"></i>';
            elements.saveFavoriteBtn.style.color = isFavorite ? 'var(--accent-color)' : 'white';
        }

        // Alternar favorito
        function toggleFavorite() {
            const day = state.currentDay;
            const index = state.favorites.indexOf(day);
            
            if (index > -1) {
                state.favorites.splice(index, 1);
                showNotification('Eliminado de favoritos üíî');
            } else {
                state.favorites.push(day);
                showNotification('¬°A√±adido a favoritos! üíñ');
                
                // Aumentar nivel de amor
                state.loveLevel = Math.min(state.loveLevel + 5, 200);
                localStorage.setItem('loveLevel', state.loveLevel);
                elements.loveLevel.textContent = state.loveLevel + '%';
            }
            
            localStorage.setItem('favorites', JSON.stringify(state.favorites));
            updateFavoriteButton(day);
            createLetters(); // Actualizar vista
        }

        // Copiar mensaje
        function copyMessage() {
            const text = `${elements.modalMessage.textContent}\n\nD√≠a ${state.currentDay}`;
            navigator.clipboard.writeText(text)
                .then(() => showNotification('¬°Mensaje copiado! üìã'))
                .catch(err => console.error('Error al copiar:', err));
        }

        // Compartir mensaje
        function shareMessage() {
            const text = `D√≠a ${state.currentDay}: ${elements.modalMessage.textContent}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Un mensaje de amor üíå',
                    text: text,
                    url: window.location.href
                });
            } else {
                copyMessage();
            }
        }

        // Mostrar siguiente mensaje
        function showNextMessage() {
            const currentIndex = messages.findIndex(msg => msg.day == state.currentDay);
            const nextIndex = (currentIndex + 1) % messages.length;
            openModal(messages[nextIndex].day);
        }

        // Mostrar espect√°culo de amor mejorado
        function showLoveSpectacle() {
            if (state.isSpectacleActive) return;
            
            state.isSpectacleActive = true;
            closeMessageModal();
            
            // 1. Apagar las luces (pantalla negra)
            elements.blackoutOverlay.classList.add('active');
            
            // 2. Iniciar cuenta regresiva
            startCountdown();
        }

        function startCountdown() {
            let count = 3;
            elements.countdown.textContent = count;
            
            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    elements.countdown.textContent = count;
                    // Efecto de sonido para cuenta regresiva
                    playSound(elements.heartSound);
                } else {
                    clearInterval(countdownInterval);
                    elements.countdown.textContent = "¬°TE AMO!";
                    
                    // Esperar un momento y luego comenzar el espect√°culo completo
                    setTimeout(() => {
                        elements.countdown.style.display = 'none';
                        beginSpectacle();
                    }, 1000);
                }
            }, 1000);
        }

        function beginSpectacle() {
            // 1. Reproducir m√∫sica autom√°ticamente
            playYellowSong();
            
            // 2. Mostrar controles de m√∫sica
            elements.musicPlayerMini.classList.add('active');
            
            // 3. Mostrar bot√≥n de regreso despu√©s de 5 segundos
            setTimeout(() => {
                elements.returnBtn.classList.add('show');
            }, 5000);
            
            // 4. Crear fuegos artificiales
            createFireworks();
            
            // 5. Mostrar mensajes de amor grandes
            showBigLoveMessages();
            
            // 6. Mostrar t√≠tulo espectacular
            elements.spectacularTitle.style.display = 'block';
            
            // 7. Crear efecto de estrellas
            createStars();
            
            // 8. Notificaci√≥n
            showNotification("üéÜ ¬°ESPECT√ÅCULO DE AMOR! üéÜ");
        }

        function playYellowSong() {
            // Intentar reproducir la canci√≥n
            elements.yellowSong.play().catch(e => {
                console.log("No se pudo reproducir la canci√≥n:", e);
                showNotification("üéµ Reproduciendo m√∫sica alternativa üéµ");
            });
        }

        function createFireworks() {
            const colors = ['#ff6b8b', '#ffd700', '#4CAF50', '#2196F3', '#9C27B0', '#FF9800'];
            const container = elements.fireworksContainer;
            
            // Crear m√∫ltiples fuegos artificiales en intervalos
            const fireworksInterval = setInterval(() => {
                // Crear 3-5 fuegos artificiales a la vez
                for (let i = 0; i < 3 + Math.random() * 2; i++) {
                    createSingleFirework(colors);
                }
            }, 800);
            
            // Guardar el intervalo para limpiarlo despu√©s
            window.fireworksInterval = fireworksInterval;
        }

        function createSingleFirework(colors) {
            const container = elements.fireworksContainer;
            
            // Posici√≥n aleatoria
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * (window.innerHeight / 2) + 100;
            
            // Color aleatorio
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // Crear fuego artificial principal
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = `${x}px`;
            firework.style.top = `${y}px`;
            firework.style.backgroundColor = color;
            firework.style.boxShadow = `0 0 20px ${color}`;
            
            // Animaci√≥n de subida
            const riseAnimation = firework.animate([
                { transform: 'translateY(100vh)', opacity: 0 },
                { transform: 'translateY(0)', opacity: 1 }
            ], {
                duration: 800,
                easing: 'ease-out'
            });
            
            riseAnimation.onfinish = () => {
                // Explotar
                explodeFirework(x, y, color);
                firework.remove();
            };
            
            container.appendChild(firework);
        }

        function explodeFirework(x, y, color) {
            const container = elements.fireworksContainer;
            const particles = 50 + Math.random() * 30;
            
            for (let i = 0; i < particles; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.backgroundColor = color;
                particle.style.boxShadow = `0 0 10px ${color}`;
                
                // √Ångulo aleatorio
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 150;
                const duration = 800 + Math.random() * 700;
                
                // Animaci√≥n de explosi√≥n
                particle.animate([
                    { 
                        transform: 'translate(0, 0) scale(1)', 
                        opacity: 1 
                    },
                    { 
                        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`, 
                        opacity: 0 
                    }
                ], {
                    duration: duration,
                    easing: 'ease-out'
                });
                
                // Eliminar despu√©s de la animaci√≥n
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.remove();
                    }
                }, duration);
                
                container.appendChild(particle);
            }
            
            // Sonido de explosi√≥n
            playSound(elements.sparkleSound);
        }

        function showBigLoveMessages() {
            const messages = [
                "TE AMO",
                "ERES MI TODO",
                "MI CORAZ√ìN ES TUYO",
                "PARA SIEMPRE",
                "MI AMOR ETERNO",
                "ERES MI SOL",
                "MI RAZ√ìN DE VIVIR",
                "CONTIGO ES PARA SIEMPRE",
                "AMOR INFINITO",
                "TE ELEGIR√çA MIL VECES M√ÅS",
                "MI VIDA ES MEJOR CONTIGO",
                "ERES MI FELICIDAD",
                "TE AMO M√ÅS QUE AYER",
                "MI ALMA TE PERTENECE",
                "JUNTOS PARA SIEMPRE"
            ];
            
            const container = elements.loveMessagesContainer;
            
            // Mostrar mensajes en intervalos
            const messageInterval = setInterval(() => {
                const message = messages[Math.floor(Math.random() * messages.length)];
                createBigLoveMessage(message);
            }, 1500);
            
            // Guardar el intervalo para limpiarlo despu√©s
            window.messageInterval = messageInterval;
        }

        function createBigLoveMessage(text) {
            const container = elements.loveMessagesContainer;
            
            const message = document.createElement('div');
            message.className = 'love-message-big';
            message.textContent = text;
            
            // Posici√≥n aleatoria
            const x = Math.random() * 70 + 15; // 15% a 85%
            const y = Math.random() * 70 + 15; // 15% a 85%
            
            message.style.left = `${x}%`;
            message.style.top = `${y}%`;
            
            // Color aleatorio
            const hue = Math.random() * 360;
            message.style.color = `hsl(${hue}, 100%, 60%)`;
            message.style.textShadow = `0 0 30px hsl(${hue}, 100%, 60%)`;
            
            // Tama√±o aleatorio
            const size = 3 + Math.random() * 2;
            message.style.fontSize = `${size}rem`;
            
            // Animaci√≥n
            message.animate([
                { opacity: 0, transform: 'translate(-50%, -50%) scale(0.5)' },
                { opacity: 1, transform: 'translate(-50%, -50%) scale(1)' },
                { opacity: 0, transform: 'translate(-50%, -50%) scale(1.5)' }
            ], {
                duration: 3000,
                easing: 'ease-in-out'
            });
            
            // Eliminar despu√©s de la animaci√≥n
            setTimeout(() => {
                if (message.parentNode) {
                    message.remove();
                }
            }, 3000);
            
            container.appendChild(message);
        }

        function createStars() {
            const container = elements.fireworksContainer;
            
            // Crear estrellas brillantes
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.width = '3px';
                    star.style.height = '3px';
                    star.style.backgroundColor = 'white';
                    star.style.boxShadow = '0 0 10px white, 0 0 20px white';
                    
                    // Posici√≥n aleatoria
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    
                    // Tama√±o aleatorio
                    const size = 0.5 + Math.random() * 1.5;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    
                    // Opacidad aleatoria
                    star.style.opacity = 0.3 + Math.random() * 0.7;
                    
                    container.appendChild(star);
                }, i * 100);
            }
        }

        function endLoveSpectacle() {
            if (!state.isSpectacleActive) return;
            
            state.isSpectacleActive = false;
            
            // 1. Detener m√∫sica
            elements.yellowSong.pause();
            elements.yellowSong.currentTime = 0;
            
            // 2. Detener intervalos
            if (window.fireworksInterval) {
                clearInterval(window.fireworksInterval);
            }
            if (window.messageInterval) {
                clearInterval(window.messageInterval);
            }
            
            // 3. Ocultar elementos del espect√°culo
            elements.blackoutOverlay.classList.remove('active');
            elements.musicPlayerMini.classList.remove('active');
            elements.returnBtn.classList.remove('show');
            elements.countdown.style.display = 'block';
            elements.countdown.textContent = "3";
            elements.spectacularTitle.style.display = 'none';
            
            // 4. Limpiar fuegos artificiales
            elements.fireworksContainer.innerHTML = '';
            elements.loveMessagesContainer.innerHTML = '';
            
            // 5. Mostrar notificaci√≥n final
            showNotification("‚ù§Ô∏è Eres el amor de mi vida ‚ù§Ô∏è");
            
            // 6. Efecto de salida
            showFloatingLove("PARA SIEMPRE CONTIGO");
            playSound(elements.heartSound);
            
            // 7. Mostrar mensajes flotantes
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    showFloatingLove();
                }, i * 500);
            }
        }

        // ===============================
// SORPRESA PRO (mejorada x1000)
// ===============================

const SurpriseFX = (() => {
  const FX = {
    styleId: "surprise-pro-styles",
    overlayId: "surprise-pro-overlay",
    running: false,
    cleanupFns: [],
    audio: null,
    reducedMotion: window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches ?? false,
  };

  function onceInjectStyles() {
    if (document.getElementById(FX.styleId)) return;

    const style = document.createElement("style");
    style.id = FX.styleId;
    style.textContent = `
      .surprise-overlay-pro{
        position:fixed; inset:0; z-index:10010;
        display:flex; flex-direction:column; align-items:center; justify-content:center;
        background: radial-gradient(circle at 20% 20%, #ff5bbd 0%, transparent 35%),
                    radial-gradient(circle at 80% 30%, #5bd6ff 0%, transparent 35%),
                    radial-gradient(circle at 50% 80%, #7c4dff 0%, transparent 45%),
                    linear-gradient(135deg, #0b0620, #22053b, #0b243c);
        overflow:hidden;
        animation: surpriseBg 12s infinite alternate ease-in-out;
        padding: clamp(16px, 4vw, 40px);
      }

      .surprise-card{
        width:min(860px, 92vw);
        border-radius: 24px;
        padding: clamp(18px, 3.5vw, 40px);
        background: rgba(255,255,255,0.10);
        border: 1px solid rgba(255,255,255,0.22);
        box-shadow: 0 18px 80px rgba(0,0,0,0.40);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        position: relative;
        overflow:hidden;
        transform: translateY(10px);
        animation: cardIn 650ms cubic-bezier(.2,.9,.2,1) forwards;
      }

      .surprise-card::before{
        content:"";
        position:absolute; inset:-40%;
        background: conic-gradient(from 180deg,
          rgba(255,215,0,0.18),
          rgba(255,20,147,0.14),
          rgba(0,191,255,0.14),
          rgba(138,43,226,0.14),
          rgba(255,215,0,0.18)
        );
        filter: blur(12px);
        animation: shimmer 6s linear infinite;
        pointer-events:none;
      }

      .surprise-content{
        position:relative;
        z-index:1;
        display:flex;
        flex-direction:column;
        gap: 18px;
        align-items:center;
        text-align:center;
      }

      .surprise-title{
        font-family: 'Dancing Script', cursive, system-ui;
        font-size: clamp(2.2rem, 5vw, 5rem);
        line-height: 1.0;
        color: #ffd84a;
        text-shadow: 0 0 18px rgba(255,216,74,0.6), 0 0 34px rgba(255,69,0,0.35);
        animation: titlePulse 2.8s ease-in-out infinite alternate;
        margin:0;
      }

      .surprise-heart{
        font-size: clamp(2.2rem, 4vw, 4rem);
        filter: drop-shadow(0 0 14px rgba(255,105,180,0.6));
        animation: beat 1.35s ease-in-out infinite;
      }

      .surprise-text{
        margin: 0;
        font-size: clamp(1.0rem, 1.6vw, 1.25rem);
        line-height: 1.7;
        color: rgba(255,255,255,0.92);
      }

      .surprise-strong{
        color: #fff;
        font-weight: 800;
        letter-spacing: .4px;
        text-shadow: 0 0 12px rgba(255,215,0,0.35);
      }

      .surprise-actions{
        display:flex;
        gap:12px;
        flex-wrap:wrap;
        justify-content:center;
        margin-top: 8px;
      }

      .surprise-btn{
        appearance:none;
        border:0;
        cursor:pointer;
        border-radius: 999px;
        padding: 14px 22px;
        font-weight: 800;
        font-size: 1.05rem;
        color: #fff;
        background: linear-gradient(135deg, #ff1493, #8a2be2);
        box-shadow: 0 12px 30px rgba(255,20,147,0.30);
        transform: translateZ(0);
        transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      }

      .surprise-btn:hover{
        transform: translateY(-1px);
        box-shadow: 0 16px 42px rgba(255,20,147,0.42);
        filter: brightness(1.06);
      }

      .surprise-btn:active{
        transform: translateY(1px);
        box-shadow: 0 10px 26px rgba(255,20,147,0.28);
      }

      .surprise-btn.secondary{
        background: linear-gradient(135deg, rgba(255,255,255,0.20), rgba(255,255,255,0.10));
        border: 1px solid rgba(255,255,255,0.22);
        box-shadow: 0 12px 30px rgba(0,0,0,0.25);
        font-weight: 700;
      }

      .fx-layer{
        position:absolute; inset:0;
        pointer-events:none;
        z-index:0;
      }

      .fx-particle{
        position:absolute;
        width:10px; height:10px;
        border-radius:50%;
        opacity:.95;
        will-change: transform, opacity;
        filter: drop-shadow(0 0 8px rgba(255,215,0,0.6));
      }

      .fx-heart{
        position:absolute;
        opacity:0;
        will-change: transform, opacity;
        filter: drop-shadow(0 0 10px rgba(255,105,180,0.55));
      }

      .fx-confetti{
        position:absolute;
        width: 12px;
        height: 12px;
        opacity:0.9;
        will-change: transform, opacity;
      }

      @keyframes surpriseBg{
        0%{ filter: hue-rotate(0deg) saturate(1.1); transform: scale(1); }
        100%{ filter: hue-rotate(25deg) saturate(1.3); transform: scale(1.02); }
      }

      @keyframes cardIn{
        to{ transform: translateY(0px); }
      }

      @keyframes shimmer{
        to{ transform: rotate(360deg); }
      }

      @keyframes titlePulse{
        0%{ transform: scale(1); }
        100%{ transform: scale(1.03); }
      }

      @keyframes beat{
        0%{ transform: scale(1); }
        45%{ transform: scale(1.18); }
        100%{ transform: scale(1); }
      }

      /* Reduced motion */
      @media (prefers-reduced-motion: reduce){
        .surprise-overlay-pro, .surprise-card, .surprise-card::before, .surprise-title, .surprise-heart{
          animation:none !important;
        }
      }
    `;
    document.head.appendChild(style);
  }

  function addCleanup(fn) {
    FX.cleanupFns.push(fn);
  }

  function cleanupAll() {
    // Stop audio
    try {
      if (FX.audio) {
        FX.audio.pause();
        FX.audio.currentTime = 0;
        FX.audio = null;
      }
    } catch {}

    // Run cleanup callbacks (intervals/timeouts/listeners etc.)
    for (const fn of FX.cleanupFns.splice(0)) {
      try { fn(); } catch {}
    }

    FX.running = false;
  }

  function createOverlay() {
    const overlay = document.createElement("div");
    overlay.id = FX.overlayId;
    overlay.className = "surprise-overlay-pro";
    overlay.setAttribute("role", "dialog");
    overlay.setAttribute("aria-modal", "true");
    overlay.setAttribute("aria-label", "Sorpresa especial");

    // Escape key to close
    const onKey = (e) => {
      if (e.key === "Escape") closeOverlay();
    };
    document.addEventListener("keydown", onKey);
    addCleanup(() => document.removeEventListener("keydown", onKey));

    // FX layer
    const fxLayer = document.createElement("div");
    fxLayer.className = "fx-layer";

    // Card
    const card = document.createElement("div");
    card.className = "surprise-card";

    const content = document.createElement("div");
    content.className = "surprise-content";

    const title = document.createElement("h1");
    title.className = "surprise-title";
    title.textContent = "PARA TI, MI KIM";

    const heart = document.createElement("div");
    heart.className = "surprise-heart";
    heart.textContent = "üíñ";

    // Message (m√°s pulido)
    const p1 = document.createElement("p");
    p1.className = "surprise-text";
    p1.textContent = "Eres el milagro m√°s hermoso que lleg√≥ a mi vida.";

    const p2 = document.createElement("p");
    p2.className = "surprise-text";
    p2.textContent = "Cada d√≠a contigo es un regalo que atesoro en mi coraz√≥n.";

    const p3 = document.createElement("p");
    p3.className = "surprise-text";
    p3.textContent = "No hay palabras suficientes para expresar lo que siento por ti.";

    const p4 = document.createElement("p");
    p4.className = "surprise-text";
    p4.textContent = "Por eso, cada uno de estos 117 mensajes es solo una peque√±a parte de todo el amor que siento.";

    const p5 = document.createElement("p");
    p5.className = "surprise-text surprise-strong";
    p5.textContent = "¬°TE AMO CON TODO MI SER!";

    // Actions
    const actions = document.createElement("div");
    actions.className = "surprise-actions";

    const muteBtn = document.createElement("button");
    muteBtn.className = "surprise-btn secondary";
    muteBtn.type = "button";
    muteBtn.textContent = "üîá Silenciar m√∫sica";
    muteBtn.onclick = () => toggleAudio(muteBtn);

    const closeBtn = document.createElement("button");
    closeBtn.className = "surprise-btn";
    closeBtn.type = "button";
    closeBtn.textContent = "‚ù§Ô∏è Cerrar sorpresa ‚ù§Ô∏è";
    closeBtn.onclick = () => closeOverlay(true);

    actions.appendChild(muteBtn);
    actions.appendChild(closeBtn);

    content.appendChild(title);
    content.appendChild(heart);
    content.appendChild(p1);
    content.appendChild(p2);
    content.appendChild(p3);
    content.appendChild(p4);
    content.appendChild(p5);
    content.appendChild(actions);

    card.appendChild(content);

    overlay.appendChild(fxLayer);
    overlay.appendChild(card);

    // Prevent scroll
    const prevOverflow = document.body.style.overflow;
    document.body.style.overflow = "hidden";
    addCleanup(() => (document.body.style.overflow = prevOverflow));

    document.body.appendChild(overlay);
    return { overlay, fxLayer };
  }

  function closeOverlay(withExplosion = false) {
    const overlay = document.getElementById(FX.overlayId);
    if (!overlay) return;

    overlay.remove();
    cleanupAll();

    if (withExplosion && !FX.reducedMotion) {
      // Si tienes tu showNotification, √∫salo. Si no, no pasa nada.
      try { showNotification?.("üéÄ Siempre tendr√°s sorpresas especiales, mi amor üéÄ"); } catch {}
      createLoveExplosion();
    }
  }

  function playMusic(url = "https://assets.mixkit.co/music/preview/mixkit-happy-day-583.mp3") {
    try {
      const audio = new Audio(url);
      audio.loop = true;
      audio.volume = 0.45;
      FX.audio = audio;

      // Intentar reproducir (requiere interacci√≥n del usuario)
      audio.play().catch(() => {
        // Si falla, no rompemos nada.
        try { console.log("La m√∫sica requiere interacci√≥n del usuario"); } catch {}
      });

      addCleanup(() => {
        try {
          audio.pause();
          audio.currentTime = 0;
        } catch {}
      });
    } catch {}
  }

  function toggleAudio(btn) {
    if (!FX.audio) return;

    const isPaused = FX.audio.paused;
    if (isPaused) {
      FX.audio.play().catch(() => {});
      btn.textContent = "üîá Silenciar m√∫sica";
    } else {
      FX.audio.pause();
      btn.textContent = "üîä Activar m√∫sica";
    }
  }

  // -----------------------------
  // FX: Part√≠culas / Confetti / Hearts
  // -----------------------------

  function rand(min, max) { return Math.random() * (max - min) + min; }
  function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

  function spawnParticles(fxLayer) {
    if (FX.reducedMotion) return;

    const colors = ["#FFD700", "#FFA500", "#FFEC8B", "#FFFACD"];
    const count = 120;

    const frag = document.createDocumentFragment();
    for (let i = 0; i < count; i++) {
      const el = document.createElement("div");
      el.className = "fx-particle";
      el.style.background = pick(colors);
      el.style.left = rand(0, 100) + "%";
      el.style.top = rand(0, 100) + "%";
      el.style.width = el.style.height = rand(6, 12) + "px";
      frag.appendChild(el);

      // Animate outward
      const duration = rand(1600, 3200);
      const angle = rand(0, Math.PI * 2);
      const distance = rand(140, 420);
      const dx = Math.cos(angle) * distance;
      const dy = Math.sin(angle) * distance;

      const anim = el.animate(
        [
          { transform: "translate(0,0) scale(1)", opacity: 1 },
          { transform: `translate(${dx}px, ${dy}px) scale(0)`, opacity: 0 }
        ],
        { duration, easing: "ease-out", fill: "forwards" }
      );

      addCleanup(() => { try { anim.cancel(); } catch {} });
      setTimeout(() => el.remove(), duration + 50);
    }

    fxLayer.appendChild(frag);
  }

  function spawnConfetti(fxLayer) {
    if (FX.reducedMotion) return;

    const colors = ["#FF1493", "#00BFFF", "#32CD32", "#FFD700", "#8A2BE2", "#FF4500"];
    const shapes = ["circle", "square", "triangle"];
    const count = 220;

    const frag = document.createDocumentFragment();
    for (let i = 0; i < count; i++) {
      const el = document.createElement("div");
      el.className = "fx-confetti";

      const shape = pick(shapes);
      const color = pick(colors);

      el.style.background = color;
      el.style.left = rand(0, 100) + "%";
      el.style.top = "-20px";
      el.style.width = el.style.height = rand(8, 14) + "px";
      el.style.borderRadius = shape === "circle" ? "50%" : "2px";
      if (shape === "triangle") {
        el.style.clipPath = "polygon(50% 0%, 0% 100%, 100% 100%)";
      }

      frag.appendChild(el);

      const duration = rand(2400, 4400);
      const drift = rand(-180, 180);
      const rot = rand(360, 980);

      const anim = el.animate(
        [
          { transform: "translate(0,0) rotate(0deg)", opacity: 1 },
          { transform: `translate(${drift}px, 110vh) rotate(${rot}deg)`, opacity: 0 }
        ],
        { duration, easing: "cubic-bezier(0.215, 0.610, 0.355, 1)", fill: "forwards", delay: i * 6 }
      );

      addCleanup(() => { try { anim.cancel(); } catch {} });
      setTimeout(() => el.remove(), duration + i * 6 + 50);
    }

    fxLayer.appendChild(frag);
  }

  function spawnHearts(fxLayer) {
    if (FX.reducedMotion) return;

    const hearts = ["‚ù§Ô∏è", "üíñ", "üíï", "üíó", "üíì", "üíû", "üíò", "üíù"];
    const count = 60;

    const frag = document.createDocumentFragment();
    for (let i = 0; i < count; i++) {
      const el = document.createElement("div");
      el.className = "fx-heart";
      el.textContent = pick(hearts);
      el.style.left = rand(0, 100) + "%";
      el.style.top = "105%";
      el.style.fontSize = rand(18, 46) + "px";
      frag.appendChild(el);

      const duration = rand(2600, 5200);
      const drift = rand(-120, 120);

      const anim = el.animate(
        [
          { transform: "translate(0, 0) scale(0.6)", opacity: 0 },
          { transform: "translate(0, -120px) scale(1)", opacity: 1, offset: 0.25 },
          { transform: `translate(${drift}px, -120vh) scale(0.7)`, opacity: 0 }
        ],
        { duration, easing: "cubic-bezier(0.215, 0.610, 0.355, 1)", fill: "forwards", delay: i * 70 }
      );

      addCleanup(() => { try { anim.cancel(); } catch {} });
      setTimeout(() => el.remove(), duration + i * 70 + 50);
    }

    fxLayer.appendChild(frag);
  }

  function createLoveExplosion() {
    if (FX.reducedMotion) return;

    const count = 110;
    const colors = ["#FF1493", "#FF69B4", "#FFB6C1", "#FFC0CB"];

    const layer = document.createElement("div");
    layer.className = "fx-layer";
    layer.style.zIndex = "10012";
    document.body.appendChild(layer);

    const cleanupLayer = () => { try { layer.remove(); } catch {} };
    addCleanup(cleanupLayer);

    const frag = document.createDocumentFragment();
    for (let i = 0; i < count; i++) {
      const el = document.createElement("div");
      el.textContent = "‚ù§Ô∏è";
      el.style.position = "absolute";
      el.style.left = "50%";
      el.style.top = "50%";
      el.style.fontSize = rand(18, 38) + "px";
      el.style.color = pick(colors);
      el.style.opacity = "1";
      el.style.textShadow = "0 0 18px currentColor";
      frag.appendChild(el);

      const angle = rand(0, Math.PI * 2);
      const distance = rand(140, 360);
      const dx = Math.cos(angle) * distance;
      const dy = Math.sin(angle) * distance;
      const duration = rand(900, 1700);

      const anim = el.animate(
        [
          { transform: "translate(-50%, -50%) scale(0)", opacity: 1 },
          { transform: `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px)) scale(1)`, opacity: 0 }
        ],
        { duration, easing: "ease-out", fill: "forwards", delay: i * 10 }
      );

      setTimeout(() => el.remove(), duration + i * 10 + 50);
      addCleanup(() => { try { anim.cancel(); } catch {} });
    }

    layer.appendChild(frag);
    setTimeout(cleanupLayer, 2200);
  }

  // -----------------------------
  // Public API
  // -----------------------------
  function show() {
    if (FX.running) return;
    FX.running = true;

    try { showNotification?.("‚ú® ¬°SORPRESA ESPECIAL PARA TI, MI AMOR! ‚ú®"); } catch {}

    onceInjectStyles();

    const { overlay, fxLayer } = createOverlay();

    // Auto-close safety (optional)
    // const t = setTimeout(() => closeOverlay(false), 60000);
    // addCleanup(() => clearTimeout(t));

    // FX
    spawnParticles(fxLayer);
    spawnConfetti(fxLayer);
    spawnHearts(fxLayer);

    // Music
    playMusic();

    // If user clicks outside card -> optional close
    const onClickOutside = (e) => {
      const card = overlay.querySelector(".surprise-card");
      if (card && !card.contains(e.target)) {
        // closeOverlay(true); // si quieres cerrar tocando afuera, descomenta
      }
    };
    overlay.addEventListener("mousedown", onClickOutside);
    addCleanup(() => overlay.removeEventListener("mousedown", onClickOutside));

    setTimeout(() => {
      try { showNotification?.("üíù Esta sorpresa es solo para ti, mi amor üíù"); } catch {}
    }, 900);
  }

  return { show, close: closeOverlay };
})();

// ===============================
// Reemplazo directo de tu funci√≥n
// ===============================
function showSecretSurprise() {
  // Si ya usas state.isSpectacleActive, lo respetamos:
  if (typeof state !== "undefined") {
    if (state.isSpectacleActive) return;
    state.isSpectacleActive = true;
  }

  SurpriseFX.show();

  // Cuando se cierre, libera state.isSpectacleActive
  // (Interceptamos el close para setearlo correctamente)
  const originalClose = SurpriseFX.close;
  SurpriseFX.close = function(withExplosion = false) {
    originalClose(withExplosion);
    if (typeof state !== "undefined") state.isSpectacleActive = false;
    // Restaurar por si llamas varias veces
    SurpriseFX.close = originalClose;
  };
}


// Funciones auxiliares para la sorpresa
function createGoldenParticles() {
    const particleCount = 100;
    const colors = ['#FFD700', '#FFA500', '#FFEC8B', '#FFFACD'];
    
    for (let i = 0; i < particleCount; i++) {
        setTimeout(() => {
            const particle = document.createElement('div');
            particle.style.cssText = `
                position: fixed;
                width: 10px;
                height: 10px;
                background: ${colors[Math.floor(Math.random() * colors.length)]};
                border-radius: 50%;
                pointer-events: none;
                z-index: 10011;
                box-shadow: 0 0 20px #FFD700;
            `;
            
            // Posici√≥n inicial aleatoria
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.top = `${Math.random() * 100}%`;
            
            // Animaci√≥n
            const duration = 2000 + Math.random() * 3000;
            const angle = Math.random() * Math.PI * 2;
            const distance = 200 + Math.random() * 300;
            
            particle.animate([
                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                { 
                    transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`, 
                    opacity: 0 
                }
            ], {
                duration: duration,
                easing: 'ease-out'
            });
            
            // Agregar y eliminar despu√©s
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), duration);
        }, i * 30);
    }
}

function createConfetti() {
    const confettiCount = 200;
    const shapes = ['circle', 'square', 'triangle'];
    const colors = ['#FF1493', '#00BFFF', '#32CD32', '#FFD700', '#8A2BE2', '#FF4500'];
    
    for (let i = 0; i < confettiCount; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            let shapeStyle = '';
            if (shape === 'circle') {
                shapeStyle = 'border-radius: 50%';
            } else if (shape === 'triangle') {
                shapeStyle = 'clip-path: polygon(50% 0%, 0% 100%, 100% 100%)';
            }
            
            confetti.style.cssText = `
                position: fixed;
                width: 15px;
                height: 15px;
                background: ${color};
                ${shapeStyle}
                pointer-events: none;
                z-index: 10011;
                top: -20px;
                left: ${Math.random() * 100}%;
                opacity: 0.8;
            `;
            
            // Animaci√≥n de ca√≠da
            const duration = 3000 + Math.random() * 2000;
            const endX = (Math.random() - 0.5) * 200;
            
            confetti.animate([
                { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
                { transform: `translate(${endX}px, 100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
            ], {
                duration: duration,
                easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
            });
            
            // Agregar y eliminar
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), duration);
        }, i * 10);
    }
}

function playSpecialMusic() {
    // Crear audio especial (puedes reemplazar con tu canci√≥n favorita)
    const specialAudio = new Audio('https://assets.mixkit.co/music/preview/mixkit-happy-day-583.mp3');
    specialAudio.volume = 0.5;
    
    // Intentar reproducir (solo funcionar√° con interacci√≥n del usuario)
    specialAudio.play().catch(e => {
        console.log("La m√∫sica especial requiere interacci√≥n del usuario");
    });
    
    // Guardar referencia para detenerla despu√©s
    window.specialAudio = specialAudio;
}

function createFloatingHearts() {
    const heartCount = 50;
    const heartEmojis = ['‚ù§Ô∏è', 'üíñ', 'üíï', 'üíó', 'üíì', 'üíû', 'üíò', 'üíù'];
    
    for (let i = 0; i < heartCount; i++) {
        setTimeout(() => {
            const heart = document.createElement('div');
            heart.style.cssText = `
                position: fixed;
                font-size: ${Math.random() * 30 + 20}px;
                pointer-events: none;
                z-index: 10011;
                opacity: 0;
            `;
            
            heart.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
            
            // Posici√≥n inicial (abajo)
            heart.style.left = `${Math.random() * 100}%`;
            heart.style.top = `100%`;
            
            // Animaci√≥n de flotaci√≥n
            const duration = 3000 + Math.random() * 3000;
            const endX = (Math.random() - 0.5) * 100;
            
            heart.animate([
                { 
                    transform: 'translateY(0) scale(0.5)', 
                    opacity: 0 
                },
                { 
                    transform: 'translateY(-100px) scale(1)', 
                    opacity: 1 
                },
                { 
                    transform: `translate(${endX}px, -100vh) scale(0.5)`, 
                    opacity: 0 
                }
            ], {
                duration: duration,
                easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
            });
            
            // Agregar y eliminar
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), duration);
        }, i * 100);
    }
}

function createSpecialLoveExplosion() {
    // Crear explosi√≥n final de corazones
    const explosionSize = 100;
    const explosionColors = ['#FF1493', '#FF69B4', '#FFB6C1', '#FFC0CB'];
    
    for (let i = 0; i < explosionSize; i++) {
        setTimeout(() => {
            const heart = document.createElement('div');
            heart.style.cssText = `
                position: fixed;
                font-size: 30px;
                pointer-events: none;
                z-index: 10012;
                opacity: 1;
                text-shadow: 0 0 20px currentColor;
            `;
            
            heart.textContent = '‚ù§Ô∏è';
            heart.style.color = explosionColors[Math.floor(Math.random() * explosionColors.length)];
            
            // Posici√≥n central
            const centerX = 50;
            const centerY = 50;
            
            // Animaci√≥n de explosi√≥n
            const angle = Math.random() * Math.PI * 2;
            const distance = 300 + Math.random() * 200;
            const duration = 1500 + Math.random() * 1000;
            
            heart.animate([
                { 
                    transform: `translate(${centerX}vw, ${centerY}vh) scale(0)`, 
                    opacity: 1 
                },
                { 
                    transform: `translate(${centerX + Math.cos(angle) * distance}vw, ${centerY + Math.sin(angle) * distance}vh) scale(1)`, 
                    opacity: 0 
                }
            ], {
                duration: duration,
                easing: 'ease-out'
            });
            
            // Agregar y eliminar
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), duration);
        }, i * 20);
    }
    
    // Mostrar mensaje final
    setTimeout(() => {
        showNotification('üéÄ Siempre tendr√°s sorpresas especiales, mi amor üéÄ');
    }, 1000);
}

// Y tambi√©n agrega este CSS adicional a los estilos:
const additionalStyles = document.createElement('style');
additionalStyles.textContent = `
    /* Efectos para la sorpresa secreta */
    .surprise-overlay {
        animation: surpriseEntrance 1s ease-out;
    }
    
    @keyframes surpriseEntrance {
        0% { opacity: 0; transform: scale(0.8); }
        100% { opacity: 1; transform: scale(1); }
    }
    
    .secret-message {
        position: relative;
        overflow: hidden;
    }
    
    .secret-message::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            45deg,
            transparent 30%,
            rgba(255, 215, 0, 0.1) 50%,
            transparent 70%
        );
        animation: sparkle 3s infinite linear;
        pointer-events: none;
    }
    
    @keyframes sparkle {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
`;
document.head.appendChild(additionalStyles);

        // Imprimir todos los mensajes
        function printAllMessages() {
            const printWindow = window.open('', '_blank');
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Mis Mensajes de Amor - Para KIM</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #ff2e63; text-align: center; }
                        .message { margin: 20px 0; padding: 15px; border-left: 5px solid #ff6b8b; }
                        .day { font-weight: bold; color: #ff2e63; }
                    </style>
                </head>
                <body>
                    <h1>üíå Mensajes de Amor para KIM üíå</h1>
                    ${messages.map(msg => `
                        <div class="message">
                            <div class="day">D√≠a ${msg.day}</div>
                            <div>${msg.icon} ${msg.message}</div>
                        </div>
                    `).join('')}
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // Alternar tema claro/oscuro
        function toggleTheme() {
            state.theme = state.theme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', state.theme);
            applyTheme();
            
            const icon = elements.themeBtn.querySelector('i');
            icon.className = state.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            
            showNotification(state.theme === 'light' ? 'Modo claro ‚òÄÔ∏è' : 'Modo rom√°ntico üåô');
        }

        // Aplicar tema
        function applyTheme() {
            if (state.theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        // Actualizar contadores
        function updateCounters() {
            elements.daysTogether.textContent = '117';
            elements.loveLevel.textContent = state.loveLevel + '%';
        }

        // Actualizar barra de progreso
        function updateProgress() {
            const totalMessages = messages.length;
            const viewedCount = state.viewedMessages.length;
            const percentage = Math.round((viewedCount / totalMessages) * 100);
            
            elements.progressBar.style.setProperty('--progress', `${percentage}%`);
            elements.progressBar.style.width = `${percentage}%`;
            elements.progressPercent.textContent = `${percentage}%`;
        }

        // Mostrar notificaci√≥n
        function showNotification(text) {
            elements.notificationText.textContent = text;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        // Reproducir sonido
        function playSound(audioElement) {
            audioElement.currentTime = 0;
            audioElement.play().catch(e => console.log("Audio no pudo reproducirse:", e));
        }

        // Truncar texto
        function truncateText(text, maxLength) {
            return text.length <= maxLength ? text : text.substring(0, maxLength) + '...';
        }

        // Actualizar d√≠a actual
        function updateCurrentDay(day = 1) {
            elements.currentDayElement.textContent = day;
            state.currentDay = day;
        }

        // Mostrar mensaje flotante mejorado
        function showFloatingLove(text = "TE AMO") {
            const love = elements.floatingLove.cloneNode(true);
            love.textContent = text;
            love.style.position = 'fixed';
            love.style.left = Math.random() * 80 + 10 + '%';
            love.style.top = Math.random() * 80 + 10 + '%';
            love.style.fontSize = Math.random() * 4 + 3 + 'rem';
            love.style.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
            love.style.opacity = '1';
            love.style.zIndex = '1001';
            
            document.body.appendChild(love);
            
            // Animaci√≥n
            const duration = 2000 + Math.random() * 1000;
            const animation = love.animate([
                { transform: 'translate(-50%, -50%) scale(0)', opacity: 1 },
                { transform: 'translate(-50%, -150%) scale(1.5)', opacity: 0 }
            ], {
                duration: duration,
                easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
            });
            
            animation.onfinish = () => {
                if (love.parentNode) {
                    love.remove();
                }
            };
        }

        // Inicializar part√≠culas
        if (typeof particlesJS !== 'undefined') {
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ff6b8b" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#ffa8c2",
                        opacity: 0.4,
                        width: 1
                    },
                    move: {
                        enable: true,
                        speed: 2,
                        direction: "none",
                        random: true,
                        straight: false,
                        out_mode: "out",
                        bounce: false
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" }
                    }
                }
            });
        }
    </script>
</body>
</html>
